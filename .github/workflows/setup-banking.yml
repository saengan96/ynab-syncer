name: "Initialize Bank Connection"

on:
  workflow_dispatch:
    inputs:
      bank_name:
        description: 'Bank Name (e.g., "revolut", "bank_of_cyprus", "eurobank_cy")'
        required: true
        default: 'bank_of_cyprus'

jobs:
  get-link:
    runs-on: ubuntu-latest
    steps:
      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.12' # We upgraded this to avoid the error

      - name: Install Enable Banking Library
        run: pip install enablebanking-api # Fixed library name

      - name: Generate Auth Link
        env:
          EB_APP_ID: ${{ secrets.EB_APP_ID }}
          EB_PRIVATE_KEY: ${{ secrets.EB_PRIVATE_KEY }}
        run: |
          python -c "
          import os
          import enablebanking
          
          app_id = os.getenv('EB_APP_ID')
          key_content = os.getenv('EB_PRIVATE_KEY')
          
          # Initialize client
          client = enablebanking.ApiClient('application/json', {
              'app_id': app_id,
              'key': key_content
          })
          
          auth_api = enablebanking.AuthApi(client)
          
          # This generates the link for your bank
          response = auth_api.get_auth(
              state='setup',
              redirect_uri='https://localhost',
              connector_name='${{ github.event.inputs.bank_name }}',
              country='CY'
          )
          print('\n' + '='*50)
          print('OPEN THIS LINK IN YOUR BROWSER TO AUTHORIZE:')
          print(response.url)
          print('='*50)
          "
